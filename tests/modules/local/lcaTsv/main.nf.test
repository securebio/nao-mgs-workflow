nextflow_process {

    name "Test process LCA_TSV"
    script "modules/local/lcaTsv/main.nf"
    process "LCA_TSV"
    config "tests/configs/run.config"
    tag "module"
    tag "lca_tsv"

    test("Should run without errors and produce expected output when run on valid natural input"){
        tag "expect_success"
        tag "natural"
        when {
            params {
                input_path = "${projectDir}/test-data/toy-data/lca-taxonomy/test-input.tsv"
                nodes_db_path = "${projectDir}/test-data/toy-data/lca-taxonomy/test-nodes.dmp"
                names_db_path = "${projectDir}/test-data/toy-data/lca-taxonomy/test-names.dmp"
                group_field = "seq_id"
                taxid_field = "taxid"
                score_field = "test_score"
                artificial_taxid = 8000
                prefix = "test"
                params_map = [
                    group_field: params.group_field,
                    taxid_field: params.taxid_field,
                    score_field: params.score_field,
                    taxid_artificial: params.artificial_taxid,
                    prefix: params.prefix
                ]
            }
            process {
                '''
                input[0] = Channel.of("test")
                    | combine(Channel.of(params.input_path))
                input[1] = params.nodes_db_path
                input[2] = params.names_db_path
                input[3] = params.params_map
                '''
            }
        }
        then {
            // Should run without errors
            assert process.success
        }
    }
}
