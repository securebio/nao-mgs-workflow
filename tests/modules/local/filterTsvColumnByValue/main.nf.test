nextflow_process {

    name "Test process FILTER_TSV_COLUMN_BY_VALUE"
    script "modules/local/filterTsvColumnByValue/main.nf"
    process "FILTER_TSV_COLUMN_BY_VALUE"
    config "tests/configs/run.config"
    tag "module"
    tag "filter_tsv_column_by_value"

    test("End-to-end crash test with valid input"){
        tag "expect_success"
        tag "valid_input"
        when {
            params {
                column_name = "x"
                filter_value = 6
                keep_matching = true
            }
            process {
                '''
                input[0] = Channel.of("test")
                    | combine(Channel.of("${projectDir}/test-data/toy-data/test_tab_sorted.tsv"))
                input[1] = params.column_name
                input[2] = params.filter_value
                input[3] = params.keep_matching
                '''
            }
        }
        then {
            // Should run without failures
            assert process.success
            // Output should be created
            assert path(process.out.output[0][1]).exists()
        }
    }
}
