nextflow_process {

    name "Test process COMPUTE_TAXID_DISTANCE"
    script "modules/local/computeTaxidDistance/main.nf"
    process "COMPUTE_TAXID_DISTANCE"
    config "tests/configs/run.config"
    tag "module"
    tag "compute_taxid_distance"

    test("End-to-end crash test with valid input"){
        tag "expect_success"
        tag "valid_input"
        when {
            params {
                input_path = "${projectDir}/test-data/toy-data/taxonomy-distance/test-input.tsv"
                process_params = [
                    taxid_field_1: "taxid1",
                    taxid_field_2: "taxid2",
                    distance_field_1: "distance_1",
                    distance_field_2: "distance_2"
                ]
                nodes_db_path = "${projectDir}/test-data/toy-data/taxonomy-distance/test-nodes.dmp"
            }
            process {
                '''
                input[0] = Channel.of("test").combine(Channel.of(params.input_path))
                input[1] = params.process_params
                input[2] = params.nodes_db_path
                '''
            }
        }
        then {
            // Should run without failures
            assert process.success
            // Output should be created
            assert path(process.out.output[0][1]).exists()
        }
    }

}