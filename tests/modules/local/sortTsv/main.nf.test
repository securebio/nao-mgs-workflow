def checkPlaintextSorted = { file -> ["bash", "-c", "cat " + file + " | tail -n +2 | sort -t '\t' -k1,1 -C && printf 1 || printf 0"].execute().text.trim() as Integer }

nextflow_process {

    name "Test process SORT_TSV"
    script "modules/local/sortTsv/main.nf"
    process "SORT_TSV"
    config "tests/configs/run.config"
    tag "module"
    tag "sort_tsv"

    test("End-to-end crash test with valid input"){
        tag "expect_success"
        tag "valid_input"
        when {
            params {}
            process {
                '''
                input[0] = Channel.of("test")
                    | combine(Channel.of("${projectDir}/test-data/toy-data/test_tab_unsorted.tsv"))
                input[1] = "x"
                '''
            }
        }
        then {
            // Should run without failures
            assert process.success
            // Output should be created and sorted
            def output_sorted = checkPlaintextSorted(process.out.sorted[0][1])
            assert output_sorted == 1
        }
    }

}
